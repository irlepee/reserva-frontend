<div class="main-container">
  
  <div class="top-section">
    <div class="top-left">
      <button class="back-button" (click)="goBack()">
        <i class="bi bi-arrow-left"></i>
      </button>
      <div>
        <h2>Administrar Sitio</h2>
        <p class="site-name">{{ siteName }}</p>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading-state">
    <i class="bi bi-hourglass-split"></i>
    <p>Cargando información...</p>
  </div>

  <div *ngIf="!loading" class="manage-content">
    
    <!-- Tarjetas de resumen -->
    <div class="summary-cards">
      <div class="summary-card">
        <div class="card-icon blue">
          <i class="bi bi-calendar-check"></i>
        </div>
        <div class="card-info">
          <span class="card-value">{{ stats.totalReservas }}</span>
          <span class="card-label">Total Reservas</span>
        </div>
      </div>
      
      <div class="summary-card">
        <div class="card-icon green">
          <i class="bi bi-calendar-week"></i>
        </div>
        <div class="card-info">
          <span class="card-value">{{ stats.reservasUltimaSemana }}</span>
          <span class="card-label">Última Semana</span>
        </div>
      </div>
      
      <div class="summary-card">
        <div class="card-icon purple">
          <i class="bi bi-calendar-month"></i>
        </div>
        <div class="card-info">
          <span class="card-value">{{ stats.reservasUltimoMes }}</span>
          <span class="card-label">Último Mes</span>
        </div>
      </div>
      
      <div class="summary-card">
        <div class="card-icon orange">
          <i class="bi bi-percent"></i>
        </div>
        <div class="card-info">
          <span class="card-value">{{ stats.tasaOcupacion }}%</span>
          <span class="card-label">Tasa de Ocupación</span>
        </div>
      </div>
    </div>

    <!-- Gráficas principales -->
    <div class="charts-grid">
      
      <!-- Reservas por día de la semana -->
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-bar-chart-fill"></i>
          Reservas por Día de la Semana
        </h3>
        <p class="chart-subtitle">Últimas 4 semanas</p>
        <div class="bar-chart">
          <div class="bar-item" *ngFor="let dia of stats.reservasPorDia">
            <div class="bar-container">
              <div class="bar" 
                   [style.height.%]="(dia.cantidad / getMaxReservasDia()) * 100"
                   [attr.data-value]="dia.cantidad">
              </div>
            </div>
            <span class="bar-label">{{ dia.dia }}</span>
          </div>
        </div>
      </div>

      <!-- Top recursos -->
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-trophy-fill"></i>
          Recursos Más Reservados
        </h3>
        <p class="chart-subtitle">Ranking por cantidad de reservas</p>
        <div class="ranking-list" *ngIf="stats.topRecursos.length > 0">
          <div class="ranking-item" *ngFor="let recurso of stats.topRecursos; let i = index">
            <div class="ranking-position" [ngClass]="{'gold': i === 0, 'silver': i === 1, 'bronze': i === 2}">
              {{ i + 1 }}
            </div>
            <div class="ranking-info">
              <span class="ranking-name">{{ recurso.nombre }}</span>
              <span class="ranking-count">{{ recurso.reservas }} reservas</span>
            </div>
            <div class="ranking-bar">
              <div class="ranking-fill" [style.width.%]="recurso.porcentaje"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Horas más populares -->
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-clock-fill"></i>
          Horas Más Populares
        </h3>
        <p class="chart-subtitle">Momentos con más reservas</p>
        <div class="bar-chart horizontal">
          <div class="bar-item" *ngFor="let hora of stats.horasPopulares">
            <span class="bar-label">{{ hora.hora }}</span>
            <div class="bar-container">
              <div class="bar" 
                   [style.width.%]="(hora.cantidad / getMaxHorasPopulares()) * 100"
                   [attr.data-value]="hora.cantidad">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tipos de reserva -->
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-pie-chart-fill"></i>
          Tipos de Reserva
        </h3>
        <p class="chart-subtitle">Individuales vs Grupales</p>
        <div class="reservation-types">
          <div class="type-item">
            <div class="type-icon individual">
              <i class="bi bi-person"></i>
            </div>
            <div class="type-info">
              <span class="type-value">{{ stats.tiposReserva.individuales }}</span>
              <span class="type-label">Individuales</span>
            </div>
          </div>
          <div class="type-item">
            <div class="type-icon group">
              <i class="bi bi-people"></i>
            </div>
            <div class="type-info">
              <span class="type-value">{{ stats.tiposReserva.grupales }}</span>
              <span class="type-label">Grupales</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel de Reservas -->
    <div class="reservas-section">
      <h3 class="section-title">
        <i class="bi bi-calendar-event"></i>
        Reservas del Sitio
      </h3>

      <div class="filter-buttons">
        <button class="filter-btn" [class.active]="filterStatus === 'all'" (click)="filterReservas('all')">
          Todas ({{ reservas.length }})
        </button>
        <button class="filter-btn" [class.active]="filterStatus === 'Active'" (click)="filterReservas('Active')">
          Activas ({{ getActiveReservasCount() }})
        </button>
        <button class="filter-btn" [class.active]="filterStatus === 'Cancelled'" (click)="filterReservas('Cancelled')">
          Canceladas ({{ getCancelledReservasCount() }})
        </button>
      </div>

      <div *ngIf="loadingReservas" class="loading-state">
        <i class="bi bi-hourglass-split"></i>
        <p>Cargando reservas...</p>
      </div>

      <div *ngIf="!loadingReservas && filteredReservas.length === 0" class="no-reservas">
        <i class="bi bi-inbox"></i>
        <p>No hay reservas</p>
      </div>

      <div *ngIf="!loadingReservas && filteredReservas.length > 0" class="reservas-list">
        <div class="reserva-card" *ngFor="let reserva of filteredReservas; let i = index">
          <div class="reserva-header">
            <div class="reserva-title">
              <h4>{{ reserva.resource_name }}</h4>
              <span class="reserva-group" *ngIf="reserva.group_name">
                <i class="bi bi-people"></i> {{ reserva.group_name }}
              </span>
              <span class="reserva-personal" *ngIf="!reserva.group_name">
                <i class="bi bi-person"></i> Reserva Personal
              </span>
            </div>
            <span class="status-badge" [class]="reserva.status.toLowerCase()">
              {{ reserva.status === 'Active' ? 'Activa' : 'Cancelada' }}
            </span>
          </div>

          <div class="reserva-details">
            <div class="detail-item">
              <i class="bi bi-calendar"></i>
              <span>{{ formatDate(reserva.start_date) }}</span>
            </div>
            <div class="detail-item">
              <i class="bi bi-clock"></i>
              <span>{{ formatTime(reserva.start_date) }} - {{ formatTime(reserva.end_date) }}</span>
            </div>
          </div>

          <div class="reserva-actions" *ngIf="reserva.status === 'Active'">
            <button class="btn-cancel" (click)="cancelReserva(reserva.id, i)">
              <i class="bi bi-x-circle"></i> Cancelar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
