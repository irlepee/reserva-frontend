<div class="main-container">
  <div class="top-section">
    <h2>Editar Sitio</h2>
  </div>

  <form class="form-container">
    <div class="form-wrapper">
      <!-- Left Column -->
      <div class="form-left">
        <!-- Nombre del Sitio -->
        <div class="form-group">
          <label for="siteName">Nombre del Sitio</label>
          <input type="text" id="siteName" [(ngModel)]="siteName" name="siteName" class="form-input" placeholder="Ej: Biblioteca Los Mochis">
        </div>

        <!-- Descripci√≥n -->
        <div class="form-group">
          <label for="description">Descripci√≥n</label>
          <textarea id="description" [(ngModel)]="description" name="description" class="form-textarea" placeholder="A√±ade una descripci√≥n detallada del sitio..."></textarea>
        </div>

        <!-- Estado -->
        <div class="form-group">
          <label for="estado">Estado</label>
          <input type="text" id="estado" [(ngModel)]="entidad" name="entidad" (input)="filtrarEntidad()" autocomplete="off" class="form-input" placeholder="Selecciona Estado">
          <ul *ngIf="filtradosEntidad.length > 0" class="options-list">
            <li *ngFor="let e of filtradosEntidad" (click)="seleccionarEntidad(e)">
              {{ e.name.toUpperCase() }}
            </li>
          </ul>
        </div>

        <!-- Municipio y Localidad -->
        <div class="form-row">
          <div class="form-group autocomplete-group">
            <label for="municipio">Municipio</label>
            <input type="text" id="municipio" [(ngModel)]="municipio" name="municipio" (input)="filtrarMunicipio()" autocomplete="off" class="form-input" placeholder="Selecciona Municipio">
            <ul *ngIf="filtradosMunicipio.length > 0" class="options-list">
              <li *ngFor="let m of filtradosMunicipio" (click)="seleccionarMunicipio(m)">
                {{ m.name }}
              </li>
            </ul>
          </div>
          <div class="form-group autocomplete-group">
            <label for="localidad">Localidad</label>
            <input type="text" id="localidad" [(ngModel)]="localidad" name="localidad" (input)="filtrarLocalidad()" autocomplete="off" class="form-input" placeholder="Selecciona Localidad">
            <ul *ngIf="filtradosLocalidad.length > 0" class="options-list">
              <li *ngFor="let l of filtradosLocalidad" (click)="seleccionarLocalidad(l)">
                {{ l.name }}
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="form-right">
        <!-- Galer√≠a de Im√°genes Existentes -->
        <div class="form-group" *ngIf="existingImages.length > 0">
          <label>Im√°genes Actuales</label>
          <div class="image-preview-grid">
            <div *ngFor="let image of existingImages; let i = index" class="image-preview-item">
              <img [src]="apiUrl + image" alt="preview">
              <button type="button" class="remove-btn" (click)="removeExistingImage(i)">‚úï</button>
            </div>
          </div>
        </div>

        <!-- Galer√≠a de Nuevas Im√°genes -->
        <div class="form-group">
          <label>Agregar Im√°genes</label>
          <input #fileInput type="file" multiple accept="image/*" (change)="onFileSelected($event)" style="display: none;">
          <div class="image-upload-area" (click)="fileInput.click()" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" [class.drag-over]="isDragging">
            <div class="upload-icon">üì§</div>
            <p class="upload-text">Haz clic para subir o arrastra y suelta</p>
            <p class="upload-subtext">SVG, PNG, JPG (M√ÅX. {{ 3 - existingImages.length }} im√°genes)</p>
          </div>

          <!-- Preview New Images -->
          <div class="image-preview-grid" *ngIf="imagePreview.length > 0">
            <div *ngFor="let image of imagePreview; let i = index" class="image-preview-item">
              <img [src]="image" alt="preview">
              <button type="button" class="remove-btn" (click)="removeNewImage(i)">‚úï</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Horario de apertura y cierre -->
    <div class="form-row">
      <div class="form-group">
        <label for="openingHour">Hora de apertura</label>
        <input type="time" id="openingHour" [(ngModel)]="openingHour" name="openingHour" class="form-input" min="00:00" max="23:00" step="3600">
      </div>
      <div class="form-group">
        <label for="closingHour">Hora de cierre</label>
        <input type="time" id="closingHour" [(ngModel)]="closingHour" name="closingHour" class="form-input" min="00:00" max="23:00" step="3600">
      </div>
    </div>
    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" class="btn-cancel" (click)="goBack()">Cancelar</button>
      <button type="button" class="btn-primary" (click)="updateSite()">Guardar Cambios</button>
    </div>

    <!-- Danger Section -->
    <div class="danger-section">
      <h3>Peligro</h3>
      <p>Esta acci√≥n no puede deshacerse. El sitio ser√° eliminado permanentemente.</p>
      <button type="button" class="btn-danger" (click)="openDeleteModal()">Eliminar Sitio</button>
    </div>
  </form>

  <!-- Delete Modal -->
  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>Eliminar Sitio</h2>
      <p>¬øEst√°s seguro de que deseas eliminar este sitio? Esta acci√≥n no puede deshacerse.</p>
      <div class="modal-actions">
        <button class="btn-cancel" (click)="closeDeleteModal()">Cancelar</button>
        <button class="btn-danger" (click)="confirmDeleteSite()" [disabled]="isLoadingDelete">
          {{ isLoadingDelete ? 'Eliminando...' : 'Eliminar' }}
        </button>
      </div>
    </div>
  </div>
</div>
