<div class="reservation-modal">
  <!-- PASO 1: Búsqueda de sitio -->
  <div class="step-container" *ngIf="step === 'search'">
    <div class="search-header">
      <h2>Busca un lugar para reservar</h2>
      <p>Ingresa el nombre del sitio que deseas reservar</p>
    </div>

    <div class="search-box">
      <i class="bi bi-search"></i>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="searchSites()"
        placeholder="Busca un sitio..."
        class="search-input"
      />
      <span *ngIf="isSearching" class="search-loader">
        <i class="bi bi-arrow-repeat"></i>
      </span>
    </div>

    <div class="sites-list" *ngIf="searchedSites.length > 0">
      <div class="site-item" *ngFor="let site of searchedSites" (click)="selectSite(site)">
        <div class="site-image">
          <img 
            [src]="site.image_url || site.image || '/images/placeholder.png'" 
            alt="{{ site.name }}" 
            (error)="$event.target.src='/images/placeholder.png'"
          />
        </div>
        <div class="site-info">
          <h3>{{ site.name }}</h3>
          <p>{{ site.description || 'Sin descripción' }}</p>
          <span class="site-location" *ngIf="site.location || site.municipio">
            <i class="bi bi-geo-alt"></i> {{ site.location || site.municipio }}
          </span>
        </div>
        <i class="bi bi-chevron-right"></i>
      </div>
    </div>

    <div class="no-results" *ngIf="searchTerm && searchedSites.length === 0 && !isSearching">
      <p>No se encontraron sitios</p>
    </div>
  </div>

  <!-- PASO 2: Selección de recurso -->
  <div class="step-container" *ngIf="step === 'resources'">
    <div class="step-header">
      <button class="btn-back" (click)="goBack()">← Atrás</button>
      <h2>Selecciona un recurso</h2>
    </div>

    <div class="site-details" *ngIf="selectedSite">
      <div class="site-banner">
        <img 
          [src]="selectedSite.image_url || selectedSite.image || '/images/placeholder.png'" 
          alt="{{ selectedSite.name }}"
          (error)="$event.target.src='/images/placeholder.png'"
        />
      </div>
      <div class="site-info-card">
        <h3>{{ selectedSite.name }}</h3>
        <p>{{ selectedSite.description }}</p>
        <div class="site-meta" *ngIf="selectedSite.location || selectedSite.municipio">
          <span class="meta-item">
            <i class="bi bi-geo-alt"></i> {{ selectedSite.location || selectedSite.municipio }}
          </span>
        </div>
      </div>
    </div>

    <div class="resources-container">
      <h4>Recursos disponibles</h4>
      <div class="resources-grid">
        <div
          class="resource-card"
          *ngFor="let resource of siteResources"
          (click)="selectResource(resource)"
        >
          <div class="resource-header">
            <h5>{{ resource.name }}</h5>
            <span class="resource-status" [class.available]="resource.status === 'Available'">
              {{ resource.status }}
            </span>
          </div>
          <p class="resource-capacity" *ngIf="resource.capacity">
            <i class="bi bi-people"></i> Capacidad: {{ resource.capacity }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- PASO 3: Calendario y horario -->
  <div class="step-container" *ngIf="step === 'datetime'">
    <div class="step-header">
      <button class="btn-back" (click)="goBack()">← Atrás</button>
      <h2>Selecciona fecha y horario</h2>
    </div>

    <div class="resource-selected">
      <span class="resource-name">{{ selectedResource.name }}</span>
    </div>

    <div class="datetime-container">
      <!-- Calendario -->
      <div class="calendar-section">
        <div class="calendar-header-controls">
          <button class="btn-month" (click)="previousMonth()" title="Mes anterior">
            <i class="bi bi-chevron-left"></i>
          </button>
          <h4>{{ getMonthYear() }}</h4>
          <button class="btn-month" (click)="nextMonth()" title="Mes siguiente">
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>
        
        <div class="calendar">
          <div class="calendar-header">
            <div>L</div>
            <div>M</div>
            <div>M</div>
            <div>J</div>
            <div>V</div>
            <div>S</div>
            <div>D</div>
          </div>
          <div class="calendar-days">
            <div
              class="day"
              *ngFor="let day of getCalendarDays()"
              [class.empty]="!day"
              [class.selected]="isDateSelected(day)"
              [class.disabled]="isDateDisabled(day)"
              (click)="selectDate(day)"
            >
              {{ day }}
            </div>
          </div>
        </div>

        <div *ngIf="selectedDate" class="selected-date-display">
          <i class="bi bi-check-circle-fill"></i>
          Fecha seleccionada: {{ selectedDate | date: 'dd/MM/yyyy' }}
        </div>
      </div>

      <!-- Horarios -->
      <div class="time-section">
        <h4>Horario de reserva</h4>
        <div class="time-inputs">
          <div class="time-group">
            <label>Desde</label>
            <input
              type="time"
              [(ngModel)]="startTime"
              [min]="getMinStartTime()"
              class="time-input"
            />
            <small *ngIf="selectedDate" class="time-hint">
              Desde la hora actual
            </small>
          </div>
          <div class="time-group">
            <label>Hasta</label>
            <input
              type="time"
              [(ngModel)]="endTime"
              class="time-input"
            />
            <small class="time-hint">
              Mínimo 30 minutos de duración
            </small>
          </div>
        </div>

        <div *ngIf="startTime && endTime" class="time-summary">
          <div class="time-summary-item">
            <span>Duración:</span>
            <strong>{{ calculateDuration() | number: '1.0-0' }} horas</strong>
          </div>
        </div>
      </div>
    </div>

    <button class="btn-next" (click)="goToSummary()" [disabled]="!selectedDate">
      Continuar
    </button>
  </div>

  <!-- PASO 4: Resumen -->
  <div class="step-container" *ngIf="step === 'summary'">
    <div class="step-header">
      <button class="btn-back" (click)="goBack()">← Atrás</button>
      <h2>Resumen de la reserva</h2>
    </div>

    <div class="summary-card">
      <div class="summary-section">
        <h4>Sitio</h4>
        <p>{{ selectedSite.name }}</p>
      </div>

      <div class="summary-section">
        <h4>Recurso</h4>
        <p>{{ selectedResource.name }}</p>
        <small *ngIf="selectedResource.capacity">Capacidad: {{ selectedResource.capacity }}</small>
      </div>

      <div class="summary-section">
        <h4>Fecha</h4>
        <p>{{ selectedDate | date: 'dd/MM/yyyy' }}</p>
      </div>

      <div class="summary-section">
        <h4>Horario</h4>
        <p>{{ startTime }} - {{ endTime }}</p>
      </div>
    </div>

    <button class="btn-reserve" (click)="createReservation()">
      Concretar reserva
    </button>
  </div>
</div>
